{
  "pipeline_name": "sales_data_quality_pipeline",
  "description": "Data quality rules and transformation spec generated by Chat AI from raw sales data profiling",
  "source_file": "data/raw_sales_data.csv",
  "output_file": "data/cleaned_sales_data.csv",
  "report_file": "data/quality_report.json",
  "generated_by": "Chat AI (Claude)",
  "generated_at": "2026-02-15",

  "schema": {
    "order_id":         {"type": "integer", "nullable": false, "unique": true},
    "customer_name":    {"type": "string",  "nullable": false, "min_length": 2},
    "email":            {"type": "string",  "nullable": false, "pattern": "^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z]{2,}$"},
    "product":          {"type": "string",  "nullable": false, "allowed_values": ["Laptop", "Mouse", "Keyboard", "Monitor", "Headphones"]},
    "quantity":         {"type": "integer", "nullable": false, "min_value": 1, "max_value": 1000},
    "unit_price":       {"type": "float",   "nullable": false, "min_value": 0.01},
    "order_date":       {"type": "date",    "nullable": false, "format": "YYYY-MM-DD", "min_date": "2024-01-01", "max_date": "2026-12-31"},
    "shipping_country": {"type": "string",  "nullable": false, "min_length": 2},
    "payment_method":   {"type": "string",  "nullable": false, "allowed_values": ["credit_card", "debit_card", "paypal"]},
    "status":           {"type": "string",  "nullable": false, "allowed_values": ["completed", "pending", "shipped", "cancelled"]}
  },

  "quality_rules": [
    {
      "rule_id": "R001",
      "name": "no_duplicate_orders",
      "description": "Remove exact duplicate rows based on order_id, customer_name, product, quantity, and order_date",
      "type": "deduplication",
      "columns": ["order_id", "customer_name", "product", "quantity", "order_date"],
      "action": "drop_duplicates_keep_first"
    },
    {
      "rule_id": "R002",
      "name": "null_check",
      "description": "Flag rows with null/empty values in non-nullable columns",
      "type": "completeness",
      "columns": ["order_id", "customer_name", "email", "shipping_country"],
      "action": "flag_and_report"
    },
    {
      "rule_id": "R003",
      "name": "email_format_validation",
      "description": "Validate email addresses match standard format (user@domain.tld)",
      "type": "format",
      "column": "email",
      "action": "flag_invalid"
    },
    {
      "rule_id": "R004",
      "name": "positive_quantity",
      "description": "Quantity must be a positive integer between 1 and 1000",
      "type": "range",
      "column": "quantity",
      "min_value": 1,
      "max_value": 1000,
      "action": "flag_out_of_range"
    },
    {
      "rule_id": "R005",
      "name": "positive_price",
      "description": "Unit price must be positive",
      "type": "range",
      "column": "unit_price",
      "min_value": 0.01,
      "action": "flag_negative"
    },
    {
      "rule_id": "R006",
      "name": "standardize_dates",
      "description": "Parse dates from multiple formats (YYYY-MM-DD, YYYY/MM/DD, MM-DD-YYYY) into ISO format YYYY-MM-DD",
      "type": "format_standardization",
      "column": "order_date",
      "target_format": "YYYY-MM-DD",
      "action": "parse_and_convert"
    },
    {
      "rule_id": "R007",
      "name": "valid_date_range",
      "description": "Dates must be valid calendar dates within 2024-01-01 to 2026-12-31",
      "type": "validity",
      "column": "order_date",
      "action": "flag_invalid_dates"
    },
    {
      "rule_id": "R008",
      "name": "normalize_status",
      "description": "Lowercase and standardize the status column to allowed values",
      "type": "standardization",
      "column": "status",
      "action": "lowercase_and_validate"
    },
    {
      "rule_id": "R009",
      "name": "valid_payment_method",
      "description": "Payment method must be one of: credit_card, debit_card, paypal",
      "type": "allowed_values",
      "column": "payment_method",
      "allowed": ["credit_card", "debit_card", "paypal"],
      "action": "flag_invalid"
    },
    {
      "rule_id": "R010",
      "name": "compute_total",
      "description": "Add a computed column: total_amount = quantity * unit_price (only for valid rows)",
      "type": "enrichment",
      "action": "add_column",
      "formula": "quantity * unit_price",
      "new_column": "total_amount"
    }
  ],

  "transformations": [
    {"step": 1, "action": "load_csv",               "description": "Load raw CSV with proper encoding"},
    {"step": 2, "action": "strip_whitespace",        "description": "Trim whitespace from all string columns"},
    {"step": 3, "action": "replace_null_strings",    "description": "Replace literal 'NULL', 'null', '' with NaN"},
    {"step": 4, "action": "apply_deduplication",     "description": "Apply rule R001"},
    {"step": 5, "action": "apply_null_checks",       "description": "Apply rule R002"},
    {"step": 6, "action": "standardize_dates",       "description": "Apply rule R006, R007"},
    {"step": 7, "action": "normalize_status",        "description": "Apply rule R008"},
    {"step": 8, "action": "validate_email",          "description": "Apply rule R003"},
    {"step": 9, "action": "validate_quantity",       "description": "Apply rule R004"},
    {"step": 10, "action": "validate_price",         "description": "Apply rule R005"},
    {"step": 11, "action": "validate_payment",       "description": "Apply rule R009"},
    {"step": 12, "action": "compute_total",          "description": "Apply rule R010"},
    {"step": 13, "action": "separate_clean_flagged", "description": "Split data into clean rows and flagged rows"},
    {"step": 14, "action": "export_results",         "description": "Save cleaned CSV and quality report JSON"}
  ]
}
